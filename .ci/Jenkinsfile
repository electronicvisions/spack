#!/usr/bin/env groovy

node {

    stage('compiler') {
        sh '''
        cd "/wang/environment/software/jessie/spack/${GERRIT_REFSPEC}_staging"
        set +x
        . share/spack/setup-env.sh
        set -x
        bash -x .ci/01_ensure_gcc.sh
        '''
    }

    stage('dlspy2') {
        sh '''
        cd "/wang/environment/software/jessie/spack/${GERRIT_REFSPEC}_staging"
        set +x
        . share/spack/setup-env.sh
        set -x
        bash -x .ci/02_install.sh dls_py2 \'visionary-defaults-dls ^python@2.7.14 %gcc@7.2.0\' \'gcc@7.2.0 %gcc@7.2.0\'
        '''
    }

    stage('dlspy3') {
        sh '''
        cd "/wang/environment/software/jessie/spack/${GERRIT_REFSPEC}_staging"
        set +x
        . share/spack/setup-env.sh
        set -x
        .ci/02_install.sh dls_py3 \'visionary-defaults-dls ^python@3.6.3 %gcc@7.2.0\' \'gcc@7.2.0 %gcc@7.2.0\'
        '''
    }
}
