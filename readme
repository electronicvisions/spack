
# fetch outstanding pull requests:
git remote add upstream https://github.com/LLNL/spack.git

git fetch upstream pull/5094/head:PR_cereal
git fetch upstream pull/5090/head:PR_openblas
git fetch upstream pull/3227/head:PR_filesystemview

git merge PR_cereal PR_openblas PR_filesystemview

# Install visionary-defaults by executing the following line
TEST_TMPDIR=/tmp TMPDIR=/wang/users/wv385/cluster_home/tmp bash -c 'spack install visionary-defaults@0.2.11 %gcc@4.9.2'

# Try to do it air-gapped
spack fetch visionary-defaults@0.2.11
TEST_TMPDIR=/tmp TMPDIR=/wang/users/wv385/cluster_home/tmp bash -c 'srun -p compile --mem=16GB -c8 spack install visionary-defaults@0.2.11 %gcc@4.9.2'

# generate view (doesn't yet work, ask OJB)
spack view -d yes add -i spackview visionary-defaults

# explanations:
## TMPDIR needs to be set in order to have enough space to build LLVM (check if that's still true
## TMP_TESTDIR needs to be set to a non-NFS filesystem, otherwise bazel complains

# spack view links all installed files into one folder (to cope with nfs delays)

